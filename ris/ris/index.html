<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Malwa Diagnostic Imaging â€“ RIS</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<style>
/* ---- SAME STYLES, UNTOUCHED ---- */
body{margin:0;font-family:Segoe UI,Arial,sans-serif;background:#f2f4f8}
header{position:relative;background:radial-gradient(circle at top,#1e3a8a,#020617);color:#fff;padding:36px 24px 42px;text-align:center;perspective:900px}
.corner-img{position:absolute;top:16px;width:64px;opacity:.85;filter:drop-shadow(0 6px 12px rgba(0,0,0,.6))}
.corner-img.left{left:20px}
.corner-img.right{right:20px}
.malwa-title{font-size:78px;font-weight:900;letter-spacing:10px;text-transform:uppercase;width:70%;margin:0 auto;background:linear-gradient(120deg,#fff8cc,#ffd700,#fff,#ffd700,#ffcc33,#fff8cc,#ffd700);background-size:300% 300%;animation:goldShine 4s linear infinite;-webkit-background-clip:text;-webkit-text-fill-color:transparent;text-shadow:0 2px 0 #6b5200,0 6px 0 #4b3900,0 12px 0 #2f2400,0 20px 45px rgba(0,0,0,.9),0 0 22px rgba(255,215,0,.9);transform:rotateX(14deg)}
@keyframes goldShine{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
.malwa-sub{margin-top:10px;font-size:24px;font-weight:600;letter-spacing:3px;color:#e0e7ff}
.container{padding:20px}
.card{background:#fff;border-radius:14px;padding:18px;margin-bottom:20px;box-shadow:0 10px 25px rgba(0,0,0,.08);border:1px solid #e5e7eb}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:12px}
label{font-size:13px;font-weight:600;text-transform:uppercase}
input,select,button{padding:10px;border-radius:10px;border:1px solid #cbd5e1}
button{cursor:pointer;font-weight:600}
.btn-primary{background:#2563eb;color:#fff}
.btn-success{background:#16a34a;color:#fff}
.btn-danger{background:#dc2626;color:#fff}
#editor{min-height:520px;border:1px solid #cbd5e1;border-radius:10px;padding:18px;background:#fff}
.list{max-height:200px;overflow:auto;border:1px solid #e5e7eb;border-radius:6px}
.list div{padding:8px;border-bottom:1px solid #e5e7eb;cursor:pointer}
.list div:hover{background:#f1f5f9}
footer{text-align:center;font-size:12px;color:#64748b;padding:10px}
</style>
</head>

<body>

<header>
  <img src="https://cdn-icons-png.flaticon.com/512/2966/2966481.png" class="corner-img left">
  <img src="https://cdn-icons-png.flaticon.com/512/2966/2966495.png" class="corner-img right">
  <div class="malwa-title">MALWA</div>
  <div class="malwa-sub">Diagnostic Imaging â€¢ RIS</div>
</header>

<div class="container">

<div class="card">
<h3>Patient Details</h3>
<div class="grid">
  <input id="patient_name" placeholder="Patient Name">
  <input id="uhid" placeholder="UHID">
  <input id="age_sex" placeholder="Age / Sex">
  <input type="date" id="date">
  <select id="modality" onchange="loadTemplates()">
    <option>CT</option><option>MRI</option><option>USG</option><option>XRAY</option>
  </select>
  <select id="templateDropdown" onchange="selectTemplateFromDropdown()">
    <option value="">Select Template</option>
  </select>
</div>
</div>

<div class="card">
<h3>Report Editor</h3>
<div id="editor" contenteditable="true"></div>
<div class="grid" style="margin-top:10px">
  <button class="btn-success" onclick="saveReport()">Save</button>
  <button class="btn-danger" onclick="clearEditor()">Clear</button>
</div>
</div>

<div class="card">
<h3>Saved Reports</h3>
<div class="grid">
  <input id="search_patient" placeholder="Patient name">
  <input id="search_uhid" placeholder="UHID">
  <input type="date" id="search_date">
  <button class="btn-primary" onclick="searchReports()">Search</button>
</div>
<div class="list" id="reportList"></div>
</div>

</div>

<footer>Malwa RIS â€¢ GitHub Pages + Render</footer>

<script>
/* ðŸ”¥ CHANGE THIS ONCE, NEVER AGAIN */
const API = "https://YOUR-RENDER-SERVICE.onrender.com";

/* ---------------- FUNCTIONS ---------------- */

async function loadTemplates(){
  const m = modality.value;
  templateDropdown.innerHTML = "<option>Loading...</option>";
  try{
    const r = await fetch(`${API}/api/templates/${m}`);
    const data = await r.json();
    templateDropdown.innerHTML = "<option value=''>Select Template</option>";
    data.forEach(t=>{
      templateDropdown.innerHTML += `<option value="${t.id}">${t.name}</option>`;
    });
  }catch(e){ alert("Backend not reachable"); }
}

async function selectTemplateFromDropdown(){
  if(!templateDropdown.value) return;
  const r = await fetch(`${API}/api/load_template`,{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({file_id:templateDropdown.value})
  });
  const d = await r.json();
  editor.innerHTML = d.html;
}

async function saveReport(){
  await fetch(`${API}/api/save_report`,{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({
      patient_name:patient_name.value,
      uhid:uhid.value,
      date:date.value,
      modality:modality.value,
      html:editor.innerHTML
    })
  });
  alert("Saved to Google Drive");
}

async function searchReports(){
  const r = await fetch(`${API}/api/reports?patient_name=${search_patient.value}&uhid=${search_uhid.value}&date=${search_date.value}`);
  const list = await r.json();
  reportList.innerHTML="";
  list.forEach(x=>{
    const d=document.createElement("div");
    d.textContent=`${x.patient_name} | ${x.modality} | ${x.date}`;
    d.onclick=()=>window.open(`${API}/api/download_word/${x.id}`);
    reportList.appendChild(d);
  });
}

function clearEditor(){ editor.innerHTML=""; }
</script>

</body>
</html>



