<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Malwa RIS</title>

<!-- Quill -->
<link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
<script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>

<style>
body{
    font-family:Segoe UI, Arial, sans-serif;
    background:#f3f6fb;
    padding:20px;
}
.container{
    background:white;
    padding:20px;
    border-radius:10px;
    max-width:1200px;
    margin:auto;
}
h2{
    margin-bottom:15px;
}
.grid{
    display:grid;
    grid-template-columns:repeat(4,1fr);
    gap:10px;
    margin-bottom:10px;
}
input,select{
    padding:8px;
    border-radius:6px;
    border:1px solid #cbd5e1;
}
button{
    padding:10px 14px;
    border:none;
    border-radius:6px;
    color:white;
    font-weight:600;
    cursor:pointer;
}
.blue{background:#2563eb}
.green{background:#16a34a}
.orange{background:#ea580c}
.red{background:#dc2626}

#editor{
    height:380px;
    background:white;
    margin-top:10px;
}

.actions{
    margin-top:10px;
    display:flex;
    gap:10px;
    flex-wrap:wrap;
}

table{
    width:100%;
    border-collapse:collapse;
    margin-top:15px;
}
th,td{
    border:1px solid #cbd5e1;
    padding:8px;
    font-size:13px;
}
th{background:#f1f5f9}
</style>
</head>

<body>

<div class="container">

<h2>Malwa RIS</h2>

<!-- PATIENT DETAILS -->
<div class="grid">
    <input id="patientName" placeholder="Patient Name">
    <input id="uhid" placeholder="UHID">
    <select id="modality">
        <option>CT</option>
        <option>MRI</option>
        <option>XRAY</option>
        <option>USG</option>
    </select>
    <input id="study" placeholder="Study / Region">
</div>

<!-- TEMPLATE + UPLOAD -->
<div class="grid">
    <select id="templateSelect"></select>
    <button class="blue" onclick="loadTemplate()">Load Template</button>
    <input type="file" id="wordUpload" accept=".docx">
    <button class="orange" onclick="uploadWord()">Upload Word</button>
</div>

<!-- EDITOR -->
<div id="editor"></div>

<!-- ACTION BUTTONS -->
<div class="actions">
    <button class="green" onclick="saveReport()">Save Report</button>
    <button class="blue" onclick="fetchReports()">Fetch Reports</button>
</div>

<!-- SAVED REPORTS -->
<table>
<thead>
<tr>
    <th>Modality</th>
    <th>File</th>
    <th>Download</th>
</tr>
</thead>
<tbody id="reportTable"></tbody>
</table>

</div>

<script>
/* ================= CONFIG ================= */

const API_BASE = "https://malwa-ris-backend.onrender.com";

/* change this ONLY if your repo name/path changes */
const TEMPLATE_BASE =
"https://raw.githubusercontent.com/harpreetsaini1111-dot/malwa2/main/ris/templates/";

/* ================= EDITOR ================= */

const quill = new Quill("#editor", { theme: "snow" });

/* ================= LOAD TEMPLATE LIST ================= */

fetch(TEMPLATE_BASE + "templates.json")
.then(r => r.json())
.then(list => {
    list.forEach(t => {
        templateSelect.innerHTML +=
            `<option value="${t.file}">${t.name}</option>`;
    });
});

/* ================= LOAD TEMPLATE ================= */

function loadTemplate(){
    if(!templateSelect.value){
        alert("Select a template");
        return;
    }

    fetch(API_BASE + "/api/template_from_url", {
        method: "POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify({
            url: TEMPLATE_BASE + templateSelect.value
        })
    })
    .then(r => r.json())
    .then(d => quill.root.innerHTML = d.html);
}

/* ================= UPLOAD WORD ================= */

function uploadWord(){
    const f = wordUpload.files[0];
    if(!f){
        alert("Select a Word file");
        return;
    }

    const fd = new FormData();
    fd.append("file", f);

    fetch(API_BASE + "/api/word_to_html", {
        method: "POST",
        body: fd
    })
    .then(r => r.json())
    .then(d => quill.root.innerHTML = d.html);
}

/* ================= SAVE REPORT ================= */

function saveReport(){
    if(!patientName.value || !uhid.value){
        alert("Patient name and UHID required");
        return;
    }

    fetch(API_BASE + "/api/save_report", {
        method: "POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify({
            patient_name: patientName.value,
            uhid: uhid.value,
            modality: modality.value,
            study: study.value,
            html: quill.root.innerHTML
        })
    })
    .then(r => r.json())
    .then(() => alert("Report saved to Google Drive"));
}

/* ================= FETCH REPORTS ================= */

function fetchReports(){
    fetch(API_BASE + "/api/reports")
    .then(r => r.json())
    .then(list => {
        reportTable.innerHTML = "";
        list.forEach(r => {
            reportTable.innerHTML += `
            <tr>
                <td>${r.modality}</td>
                <td>${r.filename}</td>
                <td>
                    <a href="${API_BASE}/api/download_word/${r.id}" target="_blank">
                        Download
                    </a>
                </td>
            </tr>`;
        });
    });
}
</script>

</body>
</html>





