<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Malwa RIS – Render Workflow</title>

<link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
<script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>

<style>
body{font-family:Segoe UI;background:#f3f6fb;padding:20px}
.container{background:#fff;padding:20px;border-radius:10px}
.grid{display:grid;grid-template-columns:repeat(4,1fr);gap:10px}
input,select{padding:8px;border:1px solid #ccc;border-radius:6px}
button{padding:10px 16px;border:none;border-radius:6px;color:#fff;font-weight:600;cursor:pointer}

.btn-blue{background:#2563eb}
.btn-green{background:#16a34a}
.btn-purple{background:#7c3aed}
.btn-gray{background:#374151}

#editor{height:420px;background:#fff;margin-top:10px}

table{width:100%;border-collapse:collapse;margin-top:15px}
th,td{border:1px solid #ccc;padding:6px;font-size:13px}
th{background:#f1f5f9}
</style>
</head>

<body>

<div class="container">

<h2>Malwa RIS – Word Upload → Edit → Save</h2>

<div class="grid">
    <input id="patientName" placeholder="Patient Name">
    <input id="uhid" placeholder="UHID">
    <select id="modality">
        <option>CT</option><option>MRI</option><option>USG</option><option>XRAY</option>
    </select>
    <input type="file" id="wordFile" accept=".docx">
</div>

<div style="margin-top:10px">
    <button class="btn-blue" onclick="uploadWord()">Load Word</button>
</div>

<div id="toolbar">
    <button class="ql-bold"></button>
    <button class="ql-italic"></button>
    <button class="ql-underline"></button>
    <button class="ql-list" value="ordered"></button>
    <button class="ql-list" value="bullet"></button>
</div>

<div id="editor"></div>

<div style="margin-top:10px">
    <button class="btn-green" onclick="saveReport()">Save Report</button>
    <button class="btn-purple" onclick="downloadWord()">Download Word</button>
    <button class="btn-gray" onclick="fetchReports()">Fetch Reports</button>
</div>

<table>
<thead>
<tr>
<th>Patient</th><th>UHID</th><th>Modality</th><th>Date</th><th>Download</th>
</tr>
</thead>
<tbody id="reportTable"></tbody>
</table>

</div>

<script>
const API_BASE = "https://YOUR-RENDER-APP.onrender.com";

const quill = new Quill('#editor',{theme:'snow',modules:{toolbar:'#toolbar'}});
let currentReportId = null;

function uploadWord(){
    const fd = new FormData();
    fd.append("file", wordFile.files[0]);

    fetch(API_BASE+"/api/word_to_html",{method:"POST",body:fd})
    .then(r=>r.json())
    .then(d=>quill.root.innerHTML=d.html);
}

function saveReport(){
    fetch(API_BASE+"/api/save_report",{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({
            patient_name:patientName.value,
            uhid:uhid.value,
            modality:modality.value,
            html:quill.root.innerHTML
        })
    })
    .then(r=>r.json())
    .then(d=>{
        currentReportId=d.id;
        alert("Saved");
    });
}

function downloadWord(){
    if(!currentReportId){alert("Save first");return;}
    window.open(API_BASE+"/api/download_word/"+currentReportId);
}

function fetchReports(){
    fetch(API_BASE+"/api/reports")
    .then(r=>r.json())
    .then(d=>{
        reportTable.innerHTML="";
        d.forEach(r=>{
            reportTable.innerHTML+=`
            <tr>
                <td>${r.patient}</td>
                <td>${r.uhid}</td>
                <td>${r.modality}</td>
                <td>${r.date}</td>
                <td><a href="${API_BASE}/api/download_word/${r.id}" target="_blank">Word</a></td>
            </tr>`;
        });
    });
}
</script>

</body>
</html>




