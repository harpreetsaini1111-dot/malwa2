<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Malwa Diagnostic Imaging – RIS (Test)</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<style>
body{
    margin:0;
    font-family:Segoe UI, Arial, sans-serif;
    background:#f2f4f8;
}
header{
    position:relative;
    background:radial-gradient(circle at top,#1e3a8a,#020617);
    color:#fff;
    padding:36px 24px 42px;
    text-align:center;
    perspective:900px;
}
.corner-img{
    position:absolute;
    top:16px;
    width:64px;
    opacity:0.85;
    filter:drop-shadow(0 6px 12px rgba(0,0,0,0.6));
}
.corner-img.left{left:20px}
.corner-img.right{right:20px}
.malwa-title{
    font-size:78px;
    font-weight:900;
    letter-spacing:10px;
    text-transform:uppercase;
    width:70%;
    margin:0 auto;
    position:relative;
    background:linear-gradient(120deg,
        #fff8cc 0%,
        #ffd700 20%,
        #ffffff 30%,
        #ffd700 40%,
        #ffcc33 60%,
        #fff8cc 80%,
        #ffd700 100%
    );
    background-size:300% 300%;
    animation:goldShine 4s linear infinite;
    -webkit-background-clip:text;
    -webkit-text-fill-color:transparent;
    text-shadow:
        0 2px 0 #6b5200,
        0 6px 0 #4b3900,
        0 12px 0 #2f2400,
        0 20px 45px rgba(0,0,0,0.9),
        0 0 22px rgba(255,215,0,0.9);
    transform:rotateX(14deg) translateZ(35px);
}

.malwa-title::after{
    content:"";
    position:absolute;
    inset:0;
    background:radial-gradient(circle at 20% 30%, rgba(255,255,255,0.9), transparent 35%),
               radial-gradient(circle at 70% 60%, rgba(255,255,255,0.8), transparent 40%);
    background-size:200% 200%;
    animation:sparkle 3s linear infinite;
    mix-blend-mode:screen;
    pointer-events:none;
}

@keyframes goldShine{
    0%{background-position:0% 50%}
    50%{background-position:100% 50%}
    100%{background-position:0% 50%}
}

@keyframes sparkle{
    0%{background-position:0% 0%; opacity:0.6}
    50%{background-position:100% 100%; opacity:1}
    100%{background-position:0% 0%; opacity:0.6}
}
.malwa-sub{
    margin-top:10px;
    font-size:24px;
    font-weight:600;
    letter-spacing:3px;
    color:#e0e7ff;
    text-shadow:0 2px 6px rgba(0,0,0,0.6);
}
header h1{
    margin:0;
    font-weight:600;
    letter-spacing:0.5px;
}
header small{
    opacity:.8;
}
.container{
    padding:20px;
}
.card{
    background:linear-gradient(180deg,#ffffff,#f8fafc);
    border-radius:14px;
    padding:18px;
    margin-bottom:20px;
    box-shadow:
        0 10px 25px rgba(0,0,0,0.08),
        inset 0 1px 0 rgba(255,255,255,0.6);
    border:1px solid #e5e7eb;
}
.grid{
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(180px,1fr));
    gap:12px;
}
label{
    font-size:13px;
    font-weight:600;
    letter-spacing:0.5px;
    color:#1e293b;
    text-transform:uppercase;
    background:linear-gradient(90deg,#e5e7eb,#f8fafc);
    padding:4px 8px;
    border-radius:6px;
    display:inline-block;
    box-shadow:inset 0 1px 2px rgba(0,0,0,0.1);
}
input,select,button,textarea{
    width:100%;
    padding:10px 12px;
    border-radius:10px;
    border:1px solid #cbd5e1;
    font-size:14px;
    background:linear-gradient(180deg,#ffffff,#f1f5f9);
    box-shadow:inset 0 2px 4px rgba(0,0,0,0.08);
}
button{
    border:none;
    cursor:pointer;
    font-weight:600;
}
.btn-primary{background:#2563eb;color:#fff}
.btn-success{background:#16a34a;color:#fff}
.btn-danger{background:#dc2626;color:#fff}
.btn-secondary{background:#475569;color:#fff}
button:hover{opacity:.9}

#editor{
    min-height:520px;
    border:1px solid #cbd5e1;
    border-radius:10px;
    padding:18px;
    overflow:auto;
    background:linear-gradient(180deg,#ffffff,#f8fafc);
    box-shadow:inset 0 3px 6px rgba(0,0,0,0.08);
}
#editor:focus{outline:none}

.list{
    max-height:200px;
    overflow:auto;
    border:1px solid #e5e7eb;
    border-radius:6px;
}
.list div{
    padding:8px 10px;
    cursor:pointer;
    border-bottom:1px solid #e5e7eb;
}
.list div:hover{background:#f1f5f9}
footer{
    text-align:center;
    padding:10px;
    font-size:12px;
    color:#64748b;
}
</style>
</head>
<body>

<header>
    <img src="https://cdn-icons-png.flaticon.com/512/2966/2966481.png" class="corner-img left" alt="CT">
    <img src="https://cdn-icons-png.flaticon.com/512/2966/2966495.png" class="corner-img right" alt="MRI">
    <div class="malwa-title">MALWA</div>
    <div class="malwa-sub">Diagnostic Imaging • RIS</div>
</header>

<div class="container">

<!-- PATIENT DATA -->
<div class="card">
<h3>Patient Details</h3>
<div class="grid">
    <div><label>Patient Name</label><input id="patient_name"></div>
    <div><label>UHID</label><input id="uhid"></div>
    <div><label>Age / Sex</label><input id="age_sex"></div>
    <div><label>Date</label><input type="date" id="date"></div>
    <div><label>Modality</label>
        <select id="modality" onchange="loadTemplates()">
            <option value="CT">CT</option>
            <option value="MRI">MRI</option>
            <option value="USG">USG</option>
            <option value="XRAY">X-Ray</option>
        </select>
    </div>
    <div><label>Report Template</label>
        <select id="templateDropdown" onchange="selectTemplateFromDropdown()">
            <option value="">-- Select Template --</option>
        </select>
    </div>
</div>
</div>

<!-- TEMPLATE SECTION -->
<div class="card">
<h3>Templates</h3>
<div class="grid">
    <div>
        <label>Upload Modality</label>
        <select id="uploadModality">
            <option value="CT">CT</option>
            <option value="MRI">MRI</option>
            <option value="USG">USG</option>
            <option value="XRAY">X-Ray</option>
        </select>
    </div>
    <div>
        <label>Template File (.docx)</label>
        <input type="file" id="templateFile" accept=".docx">
    </div>
    <div style="align-self:end">
        <button class="btn-primary" onclick="uploadTemplate()">Upload Template</button>
    </div>
</div>
</div>

<!-- EDITOR -->
<div class="card">
<h3>Report Editor</h3>
<div id="editor" contenteditable="true"></div>
<div class="grid" style="margin-top:12px">
    <button class="btn-success" onclick="saveReport()">Save Report</button>
    <button class="btn-danger" onclick="clearEditor()">Clear</button>
</div>
</div>

<!-- REPORT SEARCH -->
<div class="card">
<h3>Find Saved Reports</h3>
<div class="grid">
    <input placeholder="Patient name" id="search_patient">
    <input placeholder="UHID" id="search_uhid">
    <input type="date" id="search_date">
    <button class="btn-primary" onclick="searchReports()">Search</button>
</div>
<div class="list" id="reportList"></div>
</div>

</div>

<footer>
Malwa RIS • Test HTML • No emotions were harmed
</footer>

<script>
const API = "http://localhost:10000";

function loadTemplates(){
    const m = document.getElementById('modality').value;
    const dropdown = document.getElementById('templateDropdown');
    dropdown.innerHTML = '<option value="">-- Select Template --</option>';
    fetch(`${API}/api/templates/${m}`)
    .then(r=>r.json())
    .then(data=>{
        data.forEach(f=>{
            const opt = document.createElement('option');
            opt.value = f.id;
            opt.textContent = f.name;
            dropdown.appendChild(opt);
        });
    });
}

function selectTemplateFromDropdown(){
    const id = document.getElementById('templateDropdown').value;
    if(!id) return;
    fetch(`${API}/api/load_template`,{
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify({file_id:id})
    })
    .then(r=>r.json())
    .then(d=>{
        document.getElementById('editor').innerHTML = d.html;
    });
}

function uploadTemplate(){
    const f = document.getElementById('templateFile').files[0];
    if(!f){ alert('Select a template file'); return; }
    const m = document.getElementById('uploadModality').value;
    const fd = new FormData();
    fd.append('file',f);
    fd.append('modality',m);
    fetch(`${API}/api/upload_template`,{method:'POST',body:fd})
    .then(()=>{
        alert('Template uploaded');
        if(document.getElementById('modality').value === m){
            loadTemplates();
        }
    });
}

function saveReport(){
    const payload = {
        patient_name:document.getElementById('patient_name').value,
        uhid:document.getElementById('uhid').value,
        date:document.getElementById('date').value,
        modality:document.getElementById('modality').value,
        html:document.getElementById('editor').innerHTML
    };
    fetch(`${API}/api/save_report`,{
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify(payload)
    })
    .then(r=>r.json())
    .then(d=>alert('Saved to Drive'));
}

function searchReports(){
    const p=document.getElementById('search_patient').value;
    const u=document.getElementById('search_uhid').value;
    const d=document.getElementById('search_date').value;
    fetch(`${API}/api/reports?patient_name=${p}&uhid=${u}&date=${d}`)
    .then(r=>r.json())
    .then(list=>{
        const box=document.getElementById('reportList');
        box.innerHTML='';
        list.forEach(r=>{
            const div=document.createElement('div');
            div.textContent=`${r.patient_name} | ${r.modality} | ${r.date}`;
            div.onclick=()=>window.open(`${API}/api/download_word/${r.id}`,'_blank');
            box.appendChild(div);
        })
    })
}

function clearEditor(){
    document.getElementById('editor').innerHTML='';
}
</script>

</body>
</html>



