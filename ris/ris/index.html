<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Malwa RIS (Word)</title>
<style>
body{font-family:Segoe UI;background:#f3f6fb;padding:20px}
.container{background:#fff;padding:20px;border-radius:10px}
.grid{display:grid;grid-template-columns:repeat(4,1fr);gap:10px}
button{padding:10px 14px;border:none;border-radius:6px;color:#fff;cursor:pointer}
.save{background:#16a34a}
.load{background:#2563eb}
.upload{background:#dc2626}
table{width:100%;border-collapse:collapse;margin-top:15px}
th,td{border:1px solid #ccc;padding:6px;font-size:13px}
th{background:#eee}
</style>
</head>

<body>
<div class="container">

<h2>Malwa RIS â€“ Word Workflow</h2>

<div class="grid">
    <input id="patientName" placeholder="Patient Name">
    <input id="uhid" placeholder="UHID">
    <select id="modality" onchange="loadTemplates()">
        <option>CT</option>
        <option>MRI</option>
        <option>USG</option>
        <option>XRAY</option>
    </select>
    <select id="templateSelect"></select>
</div>

<br>
<button class="load" onclick="downloadTemplate()">Download Template</button>

<hr>

<input type="file" id="reportFile">
<button class="upload" onclick="uploadReport()">Upload Finished Report</button>

<hr>

<button class="save" onclick="fetchReports()">Fetch Saved Reports</button>

<table>
<thead>
<tr><th>Modality</th><th>File</th><th>Download</th></tr>
</thead>
<tbody id="reportTable"></tbody>
</table>

</div>

<script>
function loadTemplates(){
    fetch("/api/templates/" + modality.value)
    .then(r=>r.json())
    .then(d=>{
        templateSelect.innerHTML="";
        d.forEach(t=>templateSelect.innerHTML+=`<option>${t}</option>`);
    });
}

function downloadTemplate(){
    window.open(`/api/template/${modality.value}/${templateSelect.value}`);
}

function uploadReport(){
    const fd = new FormData();
    fd.append("file", reportFile.files[0]);
    fd.append("modality", modality.value);
    fd.append("uhid", uhid.value);
    fd.append("patient_name", patientName.value);

    fetch("/api/upload",{method:"POST",body:fd})
    .then(r=>r.json())
    .then(()=>alert("Report uploaded"));
}

function fetchReports(){
    fetch("/api/reports")
    .then(r=>r.json())
    .then(d=>{
        reportTable.innerHTML="";
        d.forEach(r=>{
            reportTable.innerHTML+=`
            <tr>
                <td>${r.modality}</td>
                <td>${r.filename}</td>
                <td><a href="/api/report/${r.modality}/${r.filename}">Download</a></td>
            </tr>`;
        });
    });
}

loadTemplates();
</script>

</body>
</html>

