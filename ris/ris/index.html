<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Malwa RIS</title>

<!-- Quill Editor -->
<link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
<script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>

<style>
body{
    font-family: Segoe UI, Arial;
    background:#f3f6fb;
    padding:20px;
}
.container{
    background:#fff;
    padding:20px;
    border-radius:10px;
    box-shadow:0 10px 25px rgba(0,0,0,.08);
}
.grid{
    display:grid;
    grid-template-columns:repeat(4,1fr);
    gap:10px;
    margin-bottom:10px;
}
input, select{
    padding:8px;
    border-radius:6px;
    border:1px solid #cbd5e1;
}
#editor{
    height:380px;
    background:#fff;
}
button{
    padding:12px 18px;
    border:none;
    border-radius:6px;
    color:white;
    font-weight:600;
    cursor:pointer;
}
.btn-save{background:#16a34a}
.btn-fetch{background:#2563eb}
.btn-clear{background:#6b7280}

.actions{
    display:flex;
    gap:10px;
    margin:12px 0;
}

table{
    width:100%;
    border-collapse:collapse;
    margin-top:10px;
}
th, td{
    border:1px solid #cbd5e1;
    padding:6px;
    font-size:13px;
}
th{
    background:#e5e7eb;
}
</style>
</head>

<body>

<div class="container">

<h2>Malwa Diagnostic Imaging â€“ RIS</h2>

<!-- PATIENT DETAILS -->
<div class="grid">
    <input id="patientName" placeholder="Patient Name">
    <input id="age" placeholder="Age">
    <select id="gender">
        <option>Male</option>
        <option>Female</option>
    </select>
    <input id="refDoctor" placeholder="Ref Doctor">
</div>

<div class="grid">
    <input id="patientId" placeholder="UHID">
    <select id="modality">
        <option value="CT">CT</option>
        <option value="MRI">MRI</option>
        <option value="USG">USG</option>
        <option value="XRAY">XRAY</option>
    </select>
    <input disabled>
    <input disabled>
</div>

<!-- QUILL TOOLBAR -->
<div id="toolbar">
    <button class="ql-bold"></button>
    <button class="ql-italic"></button>
    <button class="ql-underline"></button>
    <button class="ql-list" value="ordered"></button>
    <button class="ql-list" value="bullet"></button>
</div>

<!-- EDITOR -->
<div id="editor"></div>

<!-- ACTION BUTTONS -->
<div class="actions">
    <button class="btn-save" onclick="saveReport()">Save Report</button>
    <button class="btn-fetch" onclick="fetchReports()">Fetch Saved Reports</button>
    <button class="btn-clear" onclick="clearForm()">Clear</button>
</div>

<!-- SAVED REPORTS TABLE -->
<table>
<thead>
<tr>
    <th>#</th>
    <th>Patient Name</th>
    <th>UHID</th>
    <th>Modality</th>
    <th>Date</th>
</tr>
</thead>
<tbody id="reportTable"></tbody>
</table>

</div>

<script>
/* ================= CONFIG ================= */
const API_BASE = ""; // same Render server

/* ================= EDITOR ================= */
const quill = new Quill('#editor', {
    theme: 'snow',
    modules: { toolbar: '#toolbar' }
});

/* ================= SAVE REPORT ================= */
function saveReport(){
    const payload = {
        patient_name: patientName.value,
        uhid: patientId.value,
        age: age.value,
        gender: gender.value,
        ref_doctor: refDoctor.value,
        modality: modality.value,
        report_html: quill.root.innerHTML,
        date: new Date().toLocaleString()
    };

    fetch(API_BASE + "/api/save", {
        method: "POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify(payload)
    })
    .then(r => r.json())
    .then(() => alert("Report saved successfully"))
    .catch(err => {
        console.error(err);
        alert("Save failed");
    });
}

/* ================= FETCH REPORTS ================= */
function fetchReports(){
    fetch(API_BASE + "/api/get")
    .then(r => r.json())
    .then(data => {
        reportTable.innerHTML = "";
        data.forEach((r, i) => {
            reportTable.innerHTML += `
            <tr>
                <td>${i+1}</td>
                <td>${r.patient_name || ""}</td>
                <td>${r.uhid || ""}</td>
                <td>${r._modality || ""}</td>
                <td>${r.date || ""}</td>
            </tr>`;
        });
    })
    .catch(err => {
        console.error(err);
        alert("Fetch failed");
    });
}

/* ================= CLEAR ================= */
function clearForm(){
    patientName.value = "";
    patientId.value = "";
    age.value = "";
    refDoctor.value = "";
    quill.root.innerHTML = "";
}
</script>

</body>
</html>


