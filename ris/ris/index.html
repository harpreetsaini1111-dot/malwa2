<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Malwa RIS â€“ Word Editor</title>

<!-- Quill Editor -->
<link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
<script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>

<style>
body{
    font-family:Segoe UI, Arial;
    background:#f3f6fb;
    padding:20px;
}
.container{
    background:#fff;
    padding:20px;
    border-radius:10px;
    max-width:1100px;
    margin:auto;
}
h2{margin-bottom:10px}
h3{margin-top:25px;color:#374151}

.grid{
    display:grid;
    grid-template-columns:repeat(4,1fr);
    gap:10px;
}
input, select{
    padding:8px;
    border-radius:6px;
    border:1px solid #ccc;
}
.actions{
    margin-top:10px;
    display:flex;
    gap:10px;
    flex-wrap:wrap;
}
button{
    padding:10px 16px;
    border:none;
    border-radius:6px;
    color:white;
    font-weight:600;
    cursor:pointer;
}
.btn-blue{background:#2563eb}
.btn-green{background:#16a34a}
.btn-purple{background:#7c3aed}

#editor{
    height:420px;
    background:#fff;
    margin-top:10px;
}
</style>
</head>

<body>

<div class="container">

<h2>Malwa RIS â€“ Word Upload â†’ Edit â†’ Save</h2>

<!-- PATIENT DETAILS -->
<h3>1. Patient Details</h3>
<div class="grid">
    <input id="patientName" placeholder="Patient Name">
    <input id="uhid" placeholder="UHID">
    <select id="modality">
        <option>CT</option>
        <option>MRI</option>
        <option>USG</option>
        <option>XRAY</option>
    </select>
    <input id="study" placeholder="Study / Template Name">
</div>

<!-- WORD UPLOAD -->
<h3>2. Upload Word (.docx)</h3>
<div class="actions">
    <input type="file" id="wordFile" accept=".docx">
    <button class="btn-blue" onclick="uploadWord()">Load Word into Editor</button>
</div>

<!-- EDITOR -->
<h3>3. Edit Report</h3>
<div id="toolbar">
    <button class="ql-bold"></button>
    <button class="ql-italic"></button>
    <button class="ql-underline"></button>
    <button class="ql-list" value="ordered"></button>
    <button class="ql-list" value="bullet"></button>
</div>

<div id="editor"></div>

<!-- SAVE / DOWNLOAD -->
<h3>4. Save & Download</h3>
<div class="actions">
    <button class="btn-green" onclick="saveReport()">Save Report</button>
    <button class="btn-purple" onclick="downloadWord()">Download Word</button>
</div>

</div>

<script>
/* ðŸ”´ CHANGE THIS TO YOUR RENDER BACKEND URL */
const API_BASE = "https://YOUR-APP-NAME.onrender.com";

/* Editor */
const quill = new Quill('#editor', {
    theme:'snow',
    modules:{ toolbar:'#toolbar' }
});

let currentReportId = null;

/* Upload DOCX â†’ Server â†’ HTML */
function uploadWord(){
    if(!wordFile.files[0]){
        alert("Please select a Word (.docx) file");
        return;
    }

    const fd = new FormData();
    fd.append("file", wordFile.files[0]);

    fetch(API_BASE + "/api/word_to_html", {
        method:"POST",
        body:fd
    })
    .then(r=>r.json())
    .then(d=>{
        quill.root.innerHTML = d.html;
    })
    .catch(()=>{
        alert("Failed to load Word file");
    });
}

/* Save HTML â†’ DOCX */
function saveReport(){
    fetch(API_BASE + "/api/save_report", {
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({
            patient_name: patientName.value,
            uhid: uhid.value,
            modality: modality.value,
            study: study.value,
            html: quill.root.innerHTML
        })
    })
    .then(r=>r.json())
    .then(d=>{
        currentReportId = d.id;
        alert("Report saved successfully");
    })
    .catch(()=>{
        alert("Failed to save report");
    });
}

/* Download Word */
function downloadWord(){
    if(!currentReportId){
        alert("Please save the report first");
        return;
    }
    window.open(API_BASE + "/api/download_word/" + currentReportId);
}
</script>

</body>
</html>



