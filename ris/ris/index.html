 <!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Malwa Diagnostic Imaging – RIS (Test)</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<style>
body{
    margin:0;
    font-family:Segoe UI, Arial, sans-serif;
    background:#f2f4f8;
}
header{
    background:linear-gradient(135deg,#0f172a,#1e293b);
    color:#fff;
    padding:18px 24px;
}
header h1{
    margin:0;
    font-weight:600;
    letter-spacing:0.5px;
}
header small{
    opacity:.8;
}
.container{
    padding:20px;
}
.card{
    background:#fff;
    border-radius:10px;
    padding:16px;
    margin-bottom:18px;
    box-shadow:0 8px 20px rgba(0,0,0,.05);
}
.grid{
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(180px,1fr));
    gap:12px;
}
label{
    font-size:13px;
    color:#334155;
}
input,select,button,textarea{
    width:100%;
    padding:8px 10px;
    border-radius:6px;
    border:1px solid #cbd5e1;
    font-size:14px;
}
button{
    border:none;
    cursor:pointer;
    font-weight:600;
}
.btn-primary{background:#2563eb;color:#fff}
.btn-success{background:#16a34a;color:#fff}
.btn-danger{background:#dc2626;color:#fff}
.btn-secondary{background:#475569;color:#fff}
button:hover{opacity:.9}

#editor{
    min-height:300px;
    border:1px solid #cbd5e1;
    border-radius:6px;
    padding:12px;
    overflow:auto;
}
#editor:focus{outline:none}

.list{
    max-height:200px;
    overflow:auto;
    border:1px solid #e5e7eb;
    border-radius:6px;
}
.list div{
    padding:8px 10px;
    cursor:pointer;
    border-bottom:1px solid #e5e7eb;
}
.list div:hover{background:#f1f5f9}
footer{
    text-align:center;
    padding:10px;
    font-size:12px;
    color:#64748b;
}
</style>
</head>
<body>

<header>
    <h1>Malwa Diagnostic Imaging – RIS</h1>
    <small>HTML Test Frontend (Service Account Drive)</small>
</header>

<div class="container">

<!-- PATIENT DATA -->
<div class="card">
<h3>Patient Details</h3>
<div class="grid">
    <div><label>Patient Name</label><input id="patient_name"></div>
    <div><label>UHID</label><input id="uhid"></div>
    <div><label>Age / Sex</label><input id="age_sex"></div>
    <div><label>Date</label><input type="date" id="date"></div>
    <div><label>Modality</label>
        <select id="modality" onchange="loadTemplates()">
            <option value="CT">CT</option>
            <option value="MRI">MRI</option>
            <option value="USG">USG</option>
            <option value="XRAY">X-Ray</option>
        </select>
    </div>
    <div><label>Report Template</label>
        <select id="templateDropdown" onchange="selectTemplateFromDropdown()">
            <option value="">-- Select Template --</option>
        </select>
    </div>
</div>
</div>

<!-- TEMPLATE SECTION -->
<div class="card">
<h3>Templates</h3>
<div class="grid">
    <input type="file" id="templateFile" accept=".docx">
    <button class="btn-primary" onclick="uploadTemplate()">Upload Template</button>
</div>
</div>

<!-- EDITOR -->
<div class="card">
<h3>Report Editor</h3>
<div id="editor" contenteditable="true"></div>
<div class="grid" style="margin-top:12px">
    <button class="btn-success" onclick="saveReport()">Save Report</button>
    <button class="btn-danger" onclick="clearEditor()">Clear</button>
</div>
</div>

<!-- REPORT SEARCH -->
<div class="card">
<h3>Find Saved Reports</h3>
<div class="grid">
    <input placeholder="Patient name" id="search_patient">
    <input placeholder="UHID" id="search_uhid">
    <input type="date" id="search_date">
    <button class="btn-primary" onclick="searchReports()">Search</button>
</div>
<div class="list" id="reportList"></div>
</div>

</div>

<footer>
Malwa RIS • Test HTML • No emotions were harmed
</footer>

<script>
const API = "http://localhost:10000";

function loadTemplates(){
    const m = document.getElementById('modality').value;
    const dropdown = document.getElementById('templateDropdown');
    dropdown.innerHTML = '<option value="">-- Select Template --</option>';
    fetch(`${API}/api/templates/${m}`)
    .then(r=>r.json())
    .then(data=>{
        data.forEach(f=>{
            const opt = document.createElement('option');
            opt.value = f.id;
            opt.textContent = f.name;
            dropdown.appendChild(opt);
        });
    });
}

function selectTemplateFromDropdown(){
    const id = document.getElementById('templateDropdown').value;
    if(!id) return;
    fetch(`${API}/api/load_template`,{
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify({file_id:id})
    })
    .then(r=>r.json())
    .then(d=>{
        document.getElementById('editor').innerHTML = d.html;
    });
}

function uploadTemplate(){
    const f = document.getElementById('templateFile').files[0];
    if(!f) return;
    const m = document.getElementById('modality').value;
    const fd = new FormData();
    fd.append('file',f);
    fd.append('modality',m);
    fetch(`${API}/api/upload_template`,{method:'POST',body:fd})
    .then(()=>alert('Template uploaded'));
}

function saveReport(){
    const payload = {
        patient_name:document.getElementById('patient_name').value,
        uhid:document.getElementById('uhid').value,
        date:document.getElementById('date').value,
        modality:document.getElementById('modality').value,
        html:document.getElementById('editor').innerHTML
    };
    fetch(`${API}/api/save_report`,{
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify(payload)
    })
    .then(r=>r.json())
    .then(d=>alert('Saved to Drive'));
}

function searchReports(){
    const p=document.getElementById('search_patient').value;
    const u=document.getElementById('search_uhid').value;
    const d=document.getElementById('search_date').value;
    fetch(`${API}/api/reports?patient_name=${p}&uhid=${u}&date=${d}`)
    .then(r=>r.json())
    .then(list=>{
        const box=document.getElementById('reportList');
        box.innerHTML='';
        list.forEach(r=>{
            const div=document.createElement('div');
            div.textContent=`${r.patient_name} | ${r.modality} | ${r.date}`;
            div.onclick=()=>window.open(`${API}/api/download_word/${r.id}`,'_blank');
            box.appendChild(div);
        })
    })
}

function clearEditor(){
    document.getElementById('editor').innerHTML='';
}
</script>

</body>
</html>



